<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="鑄日" href="http://blog.sunforge.cn/rss.xml"><link rel="alternate" type="application/atom+xml" title="鑄日" href="http://blog.sunforge.cn/atom.xml"><link rel="alternate" type="application/json" title="鑄日" href="http://blog.sunforge.cn/feed.json"><link rel="stylesheet" href="//fonts.sourcegcdn.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="笔记"><link rel="canonical" href="http://blog.sunforge.cn/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/"><title>Chapter 4 The Network Layer: Data Plane - 计算机网络 - 计算机科学 | Sunforge = 鑄日 = 浩蕩長夜 至此而終</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Chapter 4 The Network Layer: Data Plane</h1><div class="meta"><span class="item" title="创建时间：2022-09-11 13:06:14"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-09-11T13:06:14+08:00">2022-09-11</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>9.7k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>9 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sunforge</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclh0m9pdj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicm07ih54j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicmnywqgpj20zk0m8dwx.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipeyonbf9j20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipew8gmvyj20zk0m87wh.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="item" rel="index" title="分类于 计算机网络"><span itemprop="name">计算机网络</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://blog.sunforge.cn/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Sunforge"><meta itemprop="description" content="浩蕩長夜 至此而終, 计科人笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鑄日"></span><div class="body md" itemprop="articleBody"><h1 id="网络层数据平面"><a class="anchor" href="#网络层数据平面">#</a> 网络层：数据平面</h1><p><strong>网络层服务</strong>：</p><ul><li>在发送主机和接收主机对之间传送段 Segment</li><li>在发送端，将段封装到数据报中</li><li>在接收端，将段交给上层传输层实体</li><li>网络层协议存在于每一个主机和路由器</li><li>路由器检查每一个经过它的 IP 数据报的头部</li></ul><p><strong>网络层包含</strong>：</p><p>路由协议，IP 协议，ICMP 协议（属于信令协议，可以报告错误）</p><p><strong>网络层的关键功能</strong>：</p><p>转发（局部功能，数据平面）：分组从路由器的输入接口转发到合适的输出接口。</p><p>路由（全局功能，控制平面）：源主机到目标主机的路径。</p><p><strong>1. 数据平面和控制平面</strong>：</p><p>数据平面：</p><ul><li>是本地的，路由器的功能。</li><li>决定从路由器的输入端口到达的分组，如何转发到输出端口。</li><li>转发功能：<ul><li>传统方式：基于目标地址 + 转发表</li><li>SDN 方式：基于多个字段 + 流表</li></ul></li></ul><p>控制平面：</p><ul><li>网络范围内的逻辑</li><li>决定数据如何在路由器之间路由。决定源主机到目标主机之间的端到端路径。</li><li>2 个控制平面方法<ul><li>传统的路由算法：在路由器中被实现</li><li>software-defined networking (SDN) 在远程的服务器中被实现</li></ul></li></ul><blockquote><p><strong>传统方式</strong>：每一路由器控制平面（紧耦合，既实现控制平面功能，又实现数据平面的功能，分布式算路由表，交给 IP 路由实体，然后匹配交换转发）在一种设备上实现，但这种紧耦合，全球那么多设备，改不了。<strong>有僵化的问题</strong>。</p><p><strong>SDN 方式</strong>：逻辑集中的控制平面（可编程）。一个不同的（通常是远程的）控制器与本地控制代理（CAs）交互。控制代理向控制器上报设备状况，由控制器计算流表，然后下发给控制代理。各设备对流表进行装载后，对到来的分组作多字段匹配，然后进行操作。</p></blockquote><p><strong>2. 网络服务模型</strong>：</p><p>思考一个问题：从发送方主机到接收方主机传输数据报的通道 “通道”，网络提供什么样的服务模型？</p><ul><li>对于单个数据报的服务：<ul><li>可靠传输</li><li>延迟保证（如少于 40ms 的延迟）</li></ul></li><li>对于数据报流的服务：<ul><li>保序数据报传输</li><li>保证流的最小带宽</li><li>分组之间的延迟差（jitter）</li></ul></li></ul><table><thead><tr><th>网络架构</th><th>服务模型</th><th>带宽保证</th><th>能否不丢失</th><th>是否保序</th><th>能否低延迟</th><th>拥塞反馈</th></tr></thead><tbody><tr><td>Internet (IP)</td><td>best effort</td><td>不保证</td><td>不保证</td><td>不保证</td><td>不保证</td><td>no (inferred via loss)</td></tr><tr><td>ATM</td><td>CBR 恒定速率</td><td>constant rate</td><td>保证</td><td>保证</td><td>保证</td><td>no congestion</td></tr><tr><td>ATM</td><td>VBR 变化速率</td><td>guaranteed rate</td><td>保证</td><td>保证</td><td>保证</td><td>no congestion</td></tr><tr><td>ATM</td><td>ABR 可用比特率</td><td>guaranteed minimum</td><td>不保证</td><td>保证</td><td>不保证</td><td>yes</td></tr><tr><td>ATM</td><td>UBR 不指名比特率</td><td>不保证</td><td>不保证</td><td>保证</td><td>不保证</td><td>no</td></tr></tbody></table><blockquote><p>尽力而为是委婉的称谓。看起来声势很大，但是啥都不保证。</p></blockquote><p><strong>3. 连接建立</strong>：</p><ul><li>是第三个重要功能。<ul><li>如 ATM 网络、</li></ul></li><li>在分组传输之前，在两个主机之间，在通过一些路由器构成的路径上面，建立一个网络层连接<ul><li>涉及到的路由器</li></ul></li><li>网络层和传输层连接服务的区别：<ul><li>网络层：在 2 个主机之间，涉及到路径上的一些路由器</li><li>传输层：在 2 个进程之间，很可能只体现在端系统上（TCP 连接）</li></ul></li></ul><h1 id="路由器的组成"><a class="anchor" href="#路由器的组成">#</a> 路由器的组成</h1><p><strong>路由器结构概况</strong>：</p><p>高层面的（非常简化的）通用路由器体系架构：</p><p>路由：运行路由选择算法 / 协议（RIP, OSPF, BGP）生成路由表</p><p>转发：从输入到输出链路交换数据报，根据路由表进行分组的转发</p><p><strong>SDN 的路由器，根据流表与分组的头部进行匹配，然后按照表项的 action 对分组做动作。可以编程，控制流表的内容</strong></p><p><strong>输入端口功能</strong>：</p><p>物理层：bit 级的接收</p><p>数据链路层：链路层协议动作、解封装</p><p>网络层：有一个队列（输入端口缓存）</p><p>分布式交换：</p><ul><li>根据数据报头部信息，如目的地址，在输入端内存中的转发表中查找合适的输出端口（匹配 + 行动）</li><li>基于目标的转发：仅仅依赖于 IP 数据报的目标 IP 地址（传统方法）</li><li>通用转发：基于头部字段的任意集合进行转发</li></ul><p><strong>输入端口缓存</strong>：</p><p>当交换机构的速率小于输入端口的汇聚速率时，在输入端口可能需要排队。</p><ul><li>会产生排队延迟</li><li>若输入缓存溢出也可能造成丢失</li></ul><p>Head-of-the-Line (HOL) blocking: 排在对头的数据报阻止了队列中其他数据报向前移动。</p><p><strong>交换结构</strong>：</p><ul><li><p>将分组从输入缓冲区传输到合适的输出端口</p></li><li><p>交换速率：分组可以按照该速率从输入传输到输出</p><ul><li>运行速度经常是输入 / 输出链路速率的若干倍</li><li>N 个输入端口，交换机构的交换速率是输入线路速度的 N 倍，比较理想，这样才不会成为瓶颈。</li></ul></li><li><p>三种典型的交换机构</p><ul><li><p>基于 memory（内存）<strong>第一代路由器</strong></p><blockquote><p>在 CPU 控制下的直接交换，采用传统的计算机。</p><p>分组被拷贝到系统内存，CPU 从分组的头部提取目标地址，查找转发表，找到对应输出端口，拷贝到输出端口。</p><p>转发速率被内存的带宽限制（数据报会通过 BUS 两次）</p><p>一次只能转发一个分组</p></blockquote></li><li><p>基于 bus（总线）<strong>第二代路由器</strong></p><blockquote><p>数据报通过共享总线，从输入端口转发到输出端口，</p><p>总线竞争：交换速度受限于总线带宽</p><p>一次处理一个分组</p><p>1 Gbps bus, Cisco 1900; 32 Gbps bus, Cisco 5600 对于接入或企业级路由器，速度足够，但不适合区域或骨干网络。</p></blockquote></li><li><p>基于 crossbar（纵横互联网路）</p><blockquote><p>可以同时并发发送多个分组，克服了总线带宽的限制。</p><p>Banyan（榕树）网路，crossbar（纵横）和其他的互联网络被开发，将多个处理器连接成多处理器。</p><p>当分组从端口 A 到达，转给端口 Y，则控制器短接两个相应的总线。</p><p>高级设计：将数据报分片为固定长度的信元，通过交换网络交换</p><p>Cisco12000：以 60Gbps 的交换速率通过互联网络</p></blockquote></li></ul></li></ul><p><strong>输出端口</strong>：</p><ul><li>当数据从交换机构到达的速率比传输速率快，就需要输出端口缓存。（数据报或分组可能会被丢弃，由于拥塞，缓冲区可能没有空间）</li><li>由调度规则，选择排队的数据报进行传输（优先权调度，谁会获得最优性能，网络中立？）</li></ul><p><strong>输出端口排队</strong>：</p><p>可能有多打一的情况发生，所以要排队。</p><p>需要有一个队列，来平衡速度。</p><p>排队会带来延迟。输出端口缓存溢出，则会丢失数据。</p><p><strong>调度机制</strong>：</p><p>1. 先来先服务策略：按照分组道来的次序服务</p><p>队列满时，分组的丢弃策略：</p><ul><li>tail drop 丢弃刚刚到达的分组</li><li>priority 根据优先权丢失 / 移动分组</li><li>random 随机地丢弃 / 移除</li></ul><p>2. 优先权调度：发送最高优先权的分组。多种类型，不同类型，有不同的优先权。</p><p>3. 其他调度类型：</p><ul><li>round robin（RR），循环扫描不同类型的队列，发送完一类的一个分组，再发送下一类的一个分组。</li><li>Waited Fair Queue（WFQ），加权平均队列，在一段时间内，每个队列得到的服务时间和权重成正比。每个类在每一个循环中，获得不同权重的服务量。</li></ul><h1 id="ip-protocol"><a class="anchor" href="#ip-protocol">#</a> IP Protocol</h1><p><strong>数据报格式</strong>：</p><p>20 字节的头部。</p><blockquote><p><strong>4 字节</strong>：</p><p>ver (4 bits) 版本号（这里讨论的是 IPv4 的数据报格式）0100 就是 4</p><p>head len (4 bits) 头部的长度（以四个字节为单位，其中固定头部 20 字节，可能携带 options 部分）最少是 0011，即 5 * 4 = 20 字节</p><p>type of service (16 bits) 基本废弃不用了，表示载荷的类型，作为分组调度的依据。</p><p>length (32 bits) 数据报总长</p></blockquote><blockquote><p><strong>4 字节：分片和重组时使用</strong></p><p>identifier (16 bits) 标识</p><p>grag flag (4 bits) 标志位</p><p>fragment offset (12 bits) 段的偏移量</p></blockquote><blockquote><p><strong>4 字节</strong>：</p><p>time to live (TTL) (8 bits) 每过一个路由器减 1，减为 0 的时候，丢弃分组。然后向源主机发送一个 ICMP 的错误报告。</p><p>upper layer (8 bits) 指定上层协议，交给 TCP / UDP / ICMP / 其他</p><p>internet checksum (16 bits) 头部校验和，和 UDP 的校验和计算类似。判断分组的头部有没有出问题。</p></blockquote><blockquote><p><strong>8 字节</strong>：</p><p>source IP address (32 bits)</p><p>destination IP address (32bits)</p></blockquote><blockquote><p><strong>Options (if any) 可变长。</strong></p><p>著名的 options 有交换节点 ip 列表</p><p>一般没有 option</p></blockquote><p><strong>IP 分片和重组</strong>：</p><p>网络链路层存在 MTU（最大传输单元）限制，MTU 是链路层的帧所携带的最大数据长度。</p><blockquote><p>不同的链路类型，有不同的 MTU</p></blockquote><p>大的 IP 数据报，在网络上被分片 (fragmented)。</p><blockquote><p><strong>一个大数据报，被分片成若干个小的数据报</strong>：头部复制，body 拆分</p><ul><li>相同的 ID</li><li>不同的偏移量（偏移量，以 8 字节，即 8B 为单位）</li><li>最后一个分片，frag flag 标志位为 0，否则为 1</li></ul><p><strong>重组只在目标主机进行</strong>。若在路由器重组，会存在几个问题：</p><ol><li>路由表变化，可能不经过某个路由器了</li><li>等待所有分组到达路由器，会耽误该分组和其他分组的传输（会耽误正常工作）</li></ol><p><strong>IP 头部的信息用来标识、排序相关分片。</strong></p><ol><li>如果超时定时器内，分片有一些没到，那么已到的也要全部丢弃。</li></ol></blockquote><p><strong>IP 编址</strong>：IP 地址，标识设备的网络接口（是设备和网络交互的那个点）</p><p>IPv4: 用 32 bits 表示</p><p><strong>接口</strong>：主机 / 路由器和物理链路的连接处</p><ul><li>路由器有多个接口（必有多个接口）</li><li>主机也可能有多个接口（一般一个，可以多个）</li><li>一个 IP 地址，和一个接口关联。</li></ul><p>** 接口是如何连接的？** 后续学习，目前无需担心一个接口是如何转接到另一个接口的。</p><p><strong>子网</strong>：IP 地址：子网部分（高位 bits），主机部分（低位 bits）</p><p>** 什么是子网？** 一个子网内的节点（主机或者路由器）他们的 IP 地址高位部分相同。这些地址构成的网络的一部分叫做子网。无需路由器接入，子网内的各个主机可以在物理上相互直接到达（IP 分组一跳可达）。</p><p>** 子网如何判断？** 要判断一个子网，将每一个接口从主机或者路由器上分开，构成一个个网络 “孤岛”，每一个孤岛都称为子网 subnet</p><p><strong>可能发生子网聚集</strong>，对外可以宣称我们属于一个子网。我可以对外宣称在同一个子网，但是我们不关心这个子网内部有没有再细分为更小的子网（纯子网，非正式术语），这是我内部的事情。</p><blockquote><p>纯子网传递分组不需要经过路由器，但是可能借助交换设备</p><p>如果发生子网的聚集，那么有可能子网中传递数据需要借助路由器了</p><ul><li>路由器之间连接的网络也是子网。</li></ul></blockquote><p><strong>IP 地址分类</strong>：</p><p><strong>A 类</strong>：地址的最高位为 0，第一个字节的其他 7 个 bit 代表网络号。后面三个字节的 24 bits 代表主机号。<strong>早就分完了</strong></p><ul><li>A 类地址总共有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>7</mn></msup><mo>−</mo><mn>2</mn><mo>=</mo><mn>126</mn></mrow><annotation encoding="application/x-tex">2^7-2=126</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">6</span></span></span></span> 个网络（全 0 和全 1 的网络号不用，这是约定。）</li><li>A 类地址的每个网络中都有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2^{24}-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span></span></span></span> 个，约 1600 万个主机</li></ul><p><strong>B 类</strong>：地址最高两位为 10，然后前面两个字节中剩下的 14 bits 代表网络号。后面两个字节的 16 bits 代表主机号。<strong>早就分完了</strong></p><ul><li>B 类地址共有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>14</mn></msup><mo>−</mo><mn>2</mn><mo>=</mo><mn>16382</mn></mrow><annotation encoding="application/x-tex">2^{14}-2=16382</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">3</span><span class="mord">8</span><span class="mord">2</span></span></span></span> 个网络</li><li>每个 B 类网络中，有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>−</mo><mn>2</mn><mo>=</mo><mn>65534</mn></mrow><annotation encoding="application/x-tex">2^{16}-2=65534</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">6</span><span class="mord">5</span><span class="mord">5</span><span class="mord">3</span><span class="mord">4</span></span></span></span> 个主机</li></ul><p><strong>C 类</strong>：地址最高三位是 110，然后前面三个字节中剩下的 21 bits 代表网络号，最后的一个字节的 8 bits 代表主机号。</p><blockquote><p>一般我们获得的地址都是 C 类地址</p></blockquote><ul><li>C 类地址一共有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>21</mn></msup><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2^{21}-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span></span></span></span> 个网络（两百多万个）</li><li>每个 C 类网络中，有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>2</mn><mo>=</mo><mn>254</mn></mrow><annotation encoding="application/x-tex">2^8-2=254</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">4</span></span></span></span> 个主机</li></ul><p><strong>ABC 类地址都是单播地址，D 类地址是组播地址</strong></p><p><strong>D 类</strong>：地址的最高 4 位是 1110，后面是组播地址。这个组是依照一定的协议维护的。信息在这个组里面传播。</p><p><strong>E 类</strong>：预留的，以后再想办法分配</p><p><strong>特殊的 IP 地址</strong>：</p><ul><li>子网部分全 0：本网络</li><li>主机部分全 0：本主机</li><li>主机部分全 1：广播地址，这个网络内的所有主机</li><li>32 位全 0：代表所有主机</li><li>32 位全 1：代表本地网络广播</li><li><code>127.x.x.x</code> 地址：代表回路地址（测试地址）分组在网络层会直接网上提交，不会再往下。</li></ul><p><strong>内网（专用）地址</strong>：</p><p>地址空间的一部分，供专用地址使用</p><p>永远不会被当做共用地址分配，不会与共用地址重复。</p><blockquote><p>只在局部网络中有意义，用以区分不同的设备。</p><p><strong>路由器不对目标地址是专用地址的分组进行转发</strong></p></blockquote><p>专用地址的范围：</p><ul><li>A 类地址： <code>10.0.0.0</code> ~ <code>10.255.255.255</code> 子网掩码 <code>255.0.0.0</code></li><li>B 类地址： <code>172.16.0.0</code> ~ <code>172.31.255.255</code> 子网掩码 <code>255.255.0.0</code></li><li>C 类地址： <code>192.168.0.0</code> ~ <code>196.168.255.255</code> 子网掩码 <code>255.255.255.0</code></li></ul><p><strong>由于 B 类地址太大，可能用不完，但是 C 类地址太小，可能不够用。为了解决这个问题就需要推出一种按需分配的机制。</strong></p><p><strong>IP 编址</strong>：所以我们对一部分的 B 类地址，进行更细致的划分，产生 **CIDR（无类域间路由）**classless inter-domain routing。这让子网部分可以在任意位置，此时就需要子网掩码。</p><p><strong>子网掩码</strong>：也是是 32 位的。携带子网掩码的 IP 地址格式为 <code>a.b.c.d/x</code> 其中， <code>x</code> 是子网号的长度。</p><p>譬如，IP 地址 <code>200.23.16.0/23</code> 使用了</p><ul><li>9 位的主机号</li><li>23 位的网络号</li><li>子网掩码为 <code>11111111 11111111 11111110 00000000</code></li></ul><p>来了一个 IP 分组，如何找网络号？就与子网掩码做一个与。这样就实现了网络号提取（后面变成 0 了，因为主机号在路由表查询的时候是没有意义的。）</p><blockquote><p>互联网做路由，并不是对每个地址做路由，而是按照子网，做路由表。</p><p>互联网的路由是以网络为单位，进行路由信息的发布和计算，而不是以单个的 IP 地址来计算。</p></blockquote><p><strong>转发表和转发算法</strong>：</p><table><thead><tr><th>destination subnet num</th><th>mask</th><th>next hop</th><th>interface</th></tr></thead><tbody><tr><td>202.38.73.0</td><td>255.255.255.192</td><td>IP-x</td><td>Lan1</td></tr><tr><td>202.38.64.0</td><td>255.255.255.192</td><td>IP-y</td><td>Lan2</td></tr><tr><td>...</td><td></td><td></td><td></td></tr><tr><td>default</td><td>-</td><td>IP-z</td><td>Lan0</td></tr></tbody></table><ol><li>首先获取 IP 数据报的目标 IP 地址，然后与子网掩码进行与操作。</li><li>对得到的网络号，在转发表中 destination subnet num 比对，如果找到匹配的对应表项，就转发到对应的 IP。</li><li>转发时，需要通过 interface 交给下层的物理网络。</li><li>只有最后到达路由器的那一跳主机号有用。其他时候不关注主机号。</li><li>如果目标 IP 和所有的表项都没有匹配上，那么一定会和最后一个默认表项匹配上。则通过默认的端口（通常是网络的出口路由器对应的 IP，是网络的默认网关 ）</li></ol><p><strong>如何获得一个 IP 地址？</strong></p><ul><li><p>系统管理员会给主机分配 IP 地址，配置在一个文件中。<strong>麻烦</strong></p><ul><li><p>Wintel 模式：控制面板 --- 网络 --- 配置 --- tcp/ip --- 属性</p></li><li><p>unix 模式：修改 /etc/rc.config 文件。</p></li></ul></li><li><p>使用 DHCP 协议 dynamic host configuration protocol 从服务器中动态获得一个 IP 地址。（<strong>plug and play 模式</strong>，最大好处是自动）</p></li></ul><blockquote><p>上网需要四个信息：</p><p>IP 地址、子网掩码、Local Name Server 以及 default gateway（默认网关）</p></blockquote><p><strong>DHCP 协议（UDP）</strong>：</p><ol><li>主机上线的时候广播一下 <code>[ DHCP discover ]</code> 。目标 ip 地址选用 <code>255.255.255.255</code> 广播地址（32 位全 1）同时，因为自己没有地址，只好用 <code>0.0.0.0</code> 地址（32 位全 0）。</li><li>DHCP server 收到后，向主机提供报文相应 <code>[ DHCP offer ]</code> （携带预分配的 IP 地址等信息）即：给你这个行不行？</li><li>主机向 DHCP 确认请求 IP 地址 <code>[ DHCP request ]</code> 。即：行，我就要这个。</li><li>DHCP 服务器向主机发送地址，然后给出租用期 <code>[ DHCP ack ]</code> 。</li></ol><p><strong>如何获得一个网络的子网部分？</strong></p><ul><li><p>从 ISP 获得的地址中，进行划分。大机构可以按照部门再划分子网。<strong>网络号 + 子网号 + 主机号</strong></p></li><li><p>ICANN 分配 IP 地址。分配地址，管理 DNS，分配域名，解决冲突。</p></li></ul><p><strong>路由机构的计算和路由的通告（层次编址）和快递的模式有点像</strong>：</p><p>大机构（子网掩码 20 位），分为 8 个部门（子网掩码 23 位）每个部门的子网，要向大机构的子网发路由通告。</p><p>譬如，一个小部门的 IP 子网前缀为 <code>200.23.16.0/23</code> ，向机构发送路由通告的时候，会向机构在发送一个 IP 地址，这个地址最后会变成大机构路由器的路由表上，对应子网前缀 <code>200.23.16.0/23</code> 的路由下一跳的 IP。</p><blockquote><p>可以直接通告，也可以路由聚集（前提是子网的子网）后再通告。</p></blockquote><p>如果收购了另外的公司，可以在路由表上把新公司的 IP 地址也引导过来一起处理。</p><p><strong>路由聚集采用最长前缀匹配</strong></p><blockquote><p>路由聚集可以很大程度上减少路由的计算和通告数量。</p><p>但路由聚集会有空洞的现象（比如 8 个子网里面我只能处理 7 个，但为了聚集，我会 “吹牛”，声称我都能处理）</p><p>实际上，我们有另外一个 IP 负责处理多出来的那个子网。这时候路由表里面就会产生多个表项的匹配。这时候就采用最长前缀的匹配结果。</p></blockquote><p><strong>NAT: Network Address Translation 网络地址转换</strong></p><p>有时，本地网络只有一个有效的 IP 地址（由于很多原因，可能一些机构只有一个有效的 IP）</p><ol><li>由于不需要从 ISP 分配一块地址，只用一个地址就可以管理所有的设备。这样可以省钱。</li><li>可以在局域网内改变设备地址，无需通知外界。</li><li>可以更换外界 ISP 服务商，而不需要改动内网的设备地址。</li><li>局域网内的设备没有明确的地址，对外不可见。比较安全。</li></ol><p><strong>如何实现？</strong></p><p>需要支持 NAT 的路由器。</p><p><strong>1. 以内网主机作为源主机，连接外网的主机</strong>：数据包<strong>进出</strong>都要替换 IP 和端口（需要构建 NAT 转换表，记住这个替换关系）</p><blockquote><p>用<strong>外网 IP 上的某个端口</strong>，替代<strong>内网某个 IP 的某个端口</strong>。</p><p>总共有 65535 个端口，基本上能够支持内网机器的映射。</p><p><strong>NAT 的争议点在于</strong>：路由器是第三层的设备，但是端口号是第四层的东西。NAT 机制使得路由器对端口号作处理，违反了分层原则以及 end-to-end 的原则。</p><ul><li><strong>端到端原则</strong>：网络复杂性放到网络边缘，无需借助中转和变换，网络分组就可以直接传输到目标主机。（但 NAT 使得分组改变了，所以违反了端到端原则）</li></ul><p>但由于地址短缺（ABC 类地址早就分完了），我们不得不采用 NAT 的方式。现在一方面也在往 IPV6 转移。</p><p>NAT 地址还带来了一个问题：<strong>NAT 穿越</strong>的问题</p></blockquote><p><strong>2. 以外网主机作为源主机，连接内网的某个主机：内网穿透</strong></p><blockquote><ul><li>方案 1：静态配置 NAT，然后转发外网服务器对特定端口的请求。</li><li>方案 2：采用 UPnP 协议（IGD 协议）该协议允许内网的设备去查询 / 增加 / 删除 NAT 的表项。<strong>是自动化的静态 NAT 配置</strong>。</li><li>方案 3：中继法 used in Skype。内网设备主动向中继注册，建立连接。外部服务器也与中继进行连接。中继将两个连接进行桥接。</li></ul></blockquote><p><strong>IPv6 的产生</strong>：</p><p>32-bits 的 IPv4 地址已经用完。添加一些新特性，可以提高 IP 协议的运行效率</p><p>定义 IPv6 地址为 128-bits，规定 IPv6 的头部固定为 40 字节。数据报传输过程中，不允许分片。</p><blockquote><p>如果分组太大，超过链路的 MTU，会被丢弃，然后通过 ICMP 协议返回错误报告给源主机。</p></blockquote><p><strong>IPv6 的数据报头部格式（共 40 字节）</strong>：</p><blockquote><p><strong>4 字节</strong>：</p><p>ver (4 bits) 版本号</p><p>pri (4 bits) 优先级</p><p>flow label (24 bits) 表示数据在一个 flow。（同一个会话的所有数据可以看做一个流，然后可以对这些数据做统一的处理。这个 flow 没有严格的定义）</p></blockquote><blockquote><p><strong>4 字节</strong></p><p>payload len (16 bits) 载荷长度</p><p>next header (8 bits) 标识上层协议，指明数据交给哪个上层协议处理。如果是一个选项，那么标识了一个 TLV 数据，指示后面一个数据是什么类型的数据。（time length value）</p><p>hop limit (8 bits)</p></blockquote><blockquote><p><strong>32 字节</strong>：</p><p>source IP address (128 bits)</p><p>destination IP address (128bits)</p></blockquote><p>随后就是 data 的载荷部分。</p><p><strong>相比 IPv4 协议</strong>：</p><blockquote><ol><li>CheckSum 字段被移除。降低在每一段中的处理速度</li><li>Options 字段允许。但是放在头部之外，被 Next Header 字段标识</li><li>ICMPv6：是 ICMP 协议的升级版本，增加了报文类型（如 packet too big）。支持多播组管理功能。</li></ol></blockquote><p><strong>协议互通和过渡</strong>：隧道技术</p><p>IPv4 是汪洋大海，IPv6 是小岛。在一个岛上构建 IPv6 分组，如果要到其他岛上，就在 IPv4 的分组内携带这个完整的 IPv6 分组，然后上岛的时候再解析出来</p><p>需要相当长的时间过渡共存。</p><h1 id="通用转发和sdn"><a class="anchor" href="#通用转发和sdn">#</a> 通用转发和 SDN</h1><p>每个路由器上，都有实现路由的算法元件，交给 IP 协议实体。</p><p>数量众多，功能各异的中间盒：交换机、防火墙、NAT、IDS、负载均衡设备等。需要不同的设备去实现不同的功能，并且会不断增加新的设备。</p><p>传统的 IP 网络的行为模式比较僵化（毕竟路由器生产后，规则就固化了，改变工作方式就很困难了）</p><blockquote><p>传统的方式是通过分布式，每台设备各自实现数据平面和控制平面。</p><p>但设备常常呈现<strong>垂直集成</strong>的特点：</p><ol><li>硬件、私有的操作系统</li><li>互联网标准协议的私有实现。</li><li>从上到下都是一个厂商提供（代价大，被设备绑架，要使用一套服务）</li></ol><p>垂直集成不利于创新的生态，并且昂贵，而且管理困难。</p></blockquote><p><strong>05 年左右提出了 SDN 方式</strong>：</p><p>采用集中化的网络控制器，来实现控制平面的功能。</p><p>通过所谓的<strong>南向接口（当前有一个标准叫 OpenFlow）</strong>，把算出来的<strong>流表</strong>，发给每个设备当中的控制代理。控制代理负责把这个流表装载下来。</p><p>分组交换机依据流表，对到来的分组匹配出来的表项，做出相应的动作。</p><blockquote><p>如何匹配？可以匹配 IP，端口，头部字段等。</p><p>做出什么动作？可以转发，可以屏蔽丢弃，也可以泛洪等。</p></blockquote><p>** 网络可以编程。统一化设备功能：通过 SDN 的分组交换机，统一控制。** 运营商可以只部署一种设备，通过下发不同流表，那么 SDN 分组交换机就能表现为路由器，防火墙等。然后还可以部署网络应用。</p><p><strong>1. 转垂直集成为了水平集成</strong>：控制平面开放实现，创造出了好的生产业态，促进发展。（分组交换机、控制器和各种控制逻辑网络应用 app 可以由不同的厂商生产，专业化，然后也能引入良好的竞争）</p><p><strong>2. 集中式实现了控制逻辑，网络管理容易</strong>，集中式控制器了解网络状况，编程简单，传统方式困难。也避免了路由器的错误配置。</p><p><strong>3. 基于流表的” 匹配 + 行动 “工作模式允许 “可编程的” 分组交换机</strong>，能够实现流量工程的高级特性。</p><p><strong>SDN 架构数据平面交换机</strong>：</p><ul><li>快速、简单、商业化交换设备。采用硬件实现通用转发功能。</li><li>流表被控制器计算和安装。</li><li>基于南向 API（如 OpenFlow），SDN 控制器访问基于流的交换机</li><li>定义了哪些可以被控制，哪些不能。同时也定义了和控制器的协议。</li></ul><p><strong>SDN 控制器（网络操作系统）</strong>：</p><ul><li>维护网络的状态信息</li><li>通过上面的北向 API，和网络控制应用交互</li><li>通过下面的南向 API，和网络交换机交互</li><li>逻辑上集中，但在实现上通常由于性能、可扩展性、容错性以及鲁棒性采用分布式方法。</li></ul><p><strong>SDN 架构：网络控制应用</strong></p><ul><li>控制的大脑：采用下层（SDN 控制器）提供的服务，实现网络功能（路由器、交换机、防火墙、负载均衡、其他功能）</li><li>非绑定。可以被第三方提供，与控制器厂商通常不同。与分组交换机厂商也可以不同。</li></ul><p><strong>通用转发和 SDN</strong>：每个路由器包含一个流表（被逻辑上集中的控制器计算和分发）</p><p><strong>OpenFlow 数据平面抽象</strong>：</p><ul><li>流：由分组（帧）头部字段所定义。</li><li>通用转发：简单的分组处理规则。<ul><li>模式：将分组头部字段和流表进行匹配</li><li>行动：对于匹配上的分组，可以丢弃、转发、修改。将匹配上的分组转发给控制器。</li><li>优先权：几个模式匹配了，优先采用哪个，消除歧义。</li><li>计数器：可以对字节计数，或者对分组计数。</li></ul></li></ul><p><strong>例 转发表匹配</strong>：</p><ul><li>src: 1.2.*.* dest: 3.4.5.* drop 【防火墙规则】</li><li>src: *.*.*.* dest: 3.4.*.* forward (2) 【转发 2 端口】</li><li>src: 10.1.2.3 dest: *.*.*.* send to controller 【转发给控制器】</li></ul><p><strong>OpenFlow 的表项结构</strong>： rule + action + stars</p><ul><li>rule 流表匹配规则（对应字段不匹配就用 * 表示）：<ul><li>switch port</li><li>Link layer：VLAN ID / MAC src / MAC dest / Eth type</li><li>Network layer：IP src / IP dest / IP port</li><li>Transport layer：TCP sport / TCP dport</li></ul></li><li>action 行为：<ul><li>向特定（可能多个）端口转发</li><li>分装分组转发给控制器</li><li>丢弃分组</li><li>发送分组给处理管道（上报控制器）</li><li>修改字段</li></ul></li><li>stars：packet + byte counters 计数器</li></ul><p>目前，几乎所有网络设备的工作（如路由器、交换机、防火墙、NAT 等），都可以在 SDN 上统合。</p><table><thead><tr><th>设备</th><th>match</th><th>action</th></tr></thead><tbody><tr><td>路由器</td><td>最长前缀匹配</td><td>通过一条链路转发</td></tr><tr><td>交换机</td><td>目标 MAC 地址</td><td>转发或者泛洪</td></tr><tr><td>防火墙</td><td>IP 地址以及 TCP/UDP 端口号</td><td>允许或者禁止</td></tr><tr><td>NAT</td><td>IP 地址和端口号</td><td>重写地址和端口号</td></tr></tbody></table><p>可以精确编程控制网络的路径以及每个设备的流表。</p><div class="tags"><a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> 笔记</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-18 20:44:06" itemprop="dateModified" datetime="2022-10-18T20:44:06+08:00">2022-10-18</time> </span><span id="computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/" class="item leancloud_visitors" data-flag-title="Chapter 4 The Network Layer: Data Plane" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Sunforge 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Sunforge 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Sunforge 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Sunforge <i class="ic i-at"><em>@</em></i>鑄日</li><li class="link"><strong>本文链接：</strong> <a href="http://blog.sunforge.cn/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/" title="Chapter 4 The Network Layer: Data Plane">http://blog.sunforge.cn/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/computer-science/computer-networks/Chapter-3-Transport-Layer/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclga70tsj20zk0m84mr.jpg" title="Chapter 3 Transport Layer"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机网络</span><h3>Chapter 3 Transport Layer</h3></a></div><div class="item right"><a href="/computer-science/computer-networks/Chapter-5-The-Network-Layer-Control-Plane/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclil3m4ej20zk0m8tn8.jpg" title="Chapter 5 The Network Layer: Control Plane"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机网络</span><h3>Chapter 5 The Network Layer: Control Plane</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%95%B0%E6%8D%AE%E5%B9%B3%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">网络层：数据平面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">2.</span> <span class="toc-text">路由器的组成</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ip-protocol"><span class="toc-number">3.</span> <span class="toc-text">IP Protocol</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E8%BD%AC%E5%8F%91%E5%92%8Csdn"><span class="toc-number">4.</span> <span class="toc-text">通用转发和 SDN</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/computer-science/computer-networks/Chapter-1-Computer-Networks-and-the-Internet/" rel="bookmark" title="Chapter 1 Computer Networks and the Internet">Chapter 1 Computer Networks and the Internet</a></li><li><a href="/computer-science/computer-networks/Chapter-2-Application-Layer/" rel="bookmark" title="Chapter 2 Application Layer">Chapter 2 Application Layer</a></li><li><a href="/computer-science/computer-networks/Chapter-3-Transport-Layer/" rel="bookmark" title="Chapter 3 Transport Layer">Chapter 3 Transport Layer</a></li><li class="active"><a href="/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/" rel="bookmark" title="Chapter 4 The Network Layer: Data Plane">Chapter 4 The Network Layer: Data Plane</a></li><li><a href="/computer-science/computer-networks/Chapter-5-The-Network-Layer-Control-Plane/" rel="bookmark" title="Chapter 5 The Network Layer: Control Plane">Chapter 5 The Network Layer: Control Plane</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Sunforge" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Sunforge</p><div class="description" itemprop="description">计科人笔记</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">18</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">5</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0JFQVRJTkctSEVBUlQ=" title="https:&#x2F;&#x2F;github.com&#x2F;BEATING-HEART"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmJlYXRpbmdfaGVhcnRAeWVhaC5uZXQ=" title="mailto:beating_heart@yeah.net"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-person"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-magic"></i>魔盒</a><ul class="submenu"><li class="item"><a href="/webstack/" rel="section"><i class="ic i-star"></i>网址</a></li><li class="item"><a href="/books/" rel="section"><i class="ic i-clipboard"></i>书架</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/computer-science/computer-networks/Chapter-3-Transport-Layer/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/computer-science/computer-networks/Chapter-5-The-Network-Layer-Control-Plane/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/" title="分类于 基本法则">基本法则</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/" title="分类于 数学">数学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/%E5%87%B8%E4%BC%98%E5%8C%96/" title="分类于 凸优化">凸优化</a></div><span><a href="/fundamental/math/convex-optimization/index/" title="凸优化：索引">凸优化：索引</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/git/" title="分类于 git">git</a></div><span><a href="/computer-science/git/%E9%85%8D%E7%BD%AEgithub%E7%9A%84ssh-key/" title="配置github的ssh key (Windows)">配置github的ssh key (Windows)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" title="分类于 数据结构与算法">数据结构与算法</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/computer-science/data-structures-and-algorithms/bipartite-graph/" title="二分图">二分图</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/" title="分类于 基本法则">基本法则</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/" title="分类于 数学">数学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/%E5%87%B8%E4%BC%98%E5%8C%96/" title="分类于 凸优化">凸优化</a></div><span><a href="/fundamental/math/convex-optimization/Chapter-2-Convex-sets/" title="凸优化第二章：凸集">凸优化第二章：凸集</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/" title="Chapter 4 The Network Layer: Data Plane">Chapter 4 The Network Layer: Data Plane</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-networks/Chapter-5-The-Network-Layer-Control-Plane/" title="Chapter 5 The Network Layer: Control Plane">Chapter 5 The Network Layer: Control Plane</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/hexo/" title="分类于 Hexo 博客">Hexo 博客</a></div><span><a href="/computer-science/hexo/%E6%9B%B4%E6%96%B0Hexo%E4%B8%BB%E9%A2%98%E4%B8%BAShoka/" title="更新Hexo主题为Shoka">更新Hexo主题为Shoka</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" title="分类于 机器学习">机器学习</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/" title="分类于 回归模型">回归模型</a></div><span><a href="/computer-science/machine-learning/linear-regression/" title="机器学习：线性回归">机器学习：线性回归</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/" title="分类于 基本法则">基本法则</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/" title="分类于 数学">数学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/%E5%87%B8%E4%BC%98%E5%8C%96/" title="分类于 凸优化">凸优化</a></div><span><a href="/fundamental/math/convex-optimization/Chapter-1-introduction/" title="凸优化第一章：导论">凸优化第一章：导论</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/computer-science/data-structures-and-algorithms/index/" title="数据结构与算法：索引">数据结构与算法：索引</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Sunforge @ Sunforge</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">124k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:53</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/",favicon:{show:"但你不会停止思考，对吗？",hide:"这个世界真复杂啊 | Sunforge"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>