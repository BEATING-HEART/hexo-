<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="鑄日" href="http://blog.sunforge.cn/rss.xml"><link rel="alternate" type="application/atom+xml" title="鑄日" href="http://blog.sunforge.cn/atom.xml"><link rel="alternate" type="application/json" title="鑄日" href="http://blog.sunforge.cn/feed.json"><link rel="stylesheet" href="//fonts.sourcegcdn.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="笔记"><link rel="canonical" href="http://blog.sunforge.cn/computer-science/computer-networks/Chapter-2-Application-Layer/"><title>Chapter 2 Application Layer - 计算机网络 - 计算机科学 | Sunforge = 鑄日 = 浩蕩長夜 至此而終</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Chapter 2 Application Layer</h1><div class="meta"><span class="item" title="创建时间：2022-09-11 13:05:06"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-09-11T13:05:06+08:00">2022-09-11</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>15k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>13 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sunforge</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclg5ms2rj20zk0m8u0x.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclfb3vzhj20zk0m8wny.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipew28b65j20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclh3brzpj20zk0m8ann.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipewr8iypj20zk0m8b29.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="item" rel="index" title="分类于 计算机网络"><span itemprop="name">计算机网络</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://blog.sunforge.cn/computer-science/computer-networks/Chapter-2-Application-Layer/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Sunforge"><meta itemprop="description" content="浩蕩長夜 至此而終, 计科人笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="鑄日"></span><div class="body md" itemprop="articleBody"><h1 id="应用层原理"><a class="anchor" href="#应用层原理">#</a> 应用层原理</h1><p><strong>总述</strong>：应用层协议最多。中国在网络中应用层上的创新还不错，原创性创新一般。</p><p><strong>网络应用体系结构</strong>：C-S 模式、P2P 模式以及混合型模式</p><blockquote><p>CS 模式中，服务器是中心，先启动，并且服务器一般是固定 IP。客户端主动找服务端请求资源。可扩展性比较差，随用户规模增加，系统性能断崖式下降。</p><p>P2P 模式中，可以做到平滑扩展。同一台主机，在某些会话中是服务器，在某些会话中又是客户端。</p><p>混合型架构：Napster，在校园网中分发 mp3 音乐。服务器作为目录和注册中心。做成了 P2P 文件共享系统。</p></blockquote><p><strong>进程通信</strong>：</p><p>同一主机的进程间，通过操作系统提供的进程通信机制进行通信。</p><p>不同主机，通过报文交换来通信。分为客户端进程（发起通信的进程）和服务端进程（等待连接的进程）</p><p>注意：P2P 架构的应用也有客户端进程和服务端进程之分。</p><p><strong>分布式进程通信</strong>：</p><blockquote><p>** 应用进程如何标识自己，如何让别人找到自己？** 标识和寻址。有三个要素，主机 IP，协议 TCP/UDP，端口号。例如 HTTP 采用 TCP 协议，在 80 端口。一个进程采用 IP+port 标识端节点。本质上，任何一对应用进程之间的通信就是两个端节点（end point）之间的通信</p><p>** 应用层如何使用传输层提供的服务？** 形式：使用应用程序接口 API 也就是 socket API，位置：层间接口的 SAP 处，就是 socket。</p><p>层间接口必须携带的信息：</p><ol><li>要传输的报文（即传输层 SDU）</li><li>然后是源主机以及目的主机的标识（ip+port）。</li></ol><p>传输时，可能在某个时间段内，要传输大量的信息，如果每个报文都要加上 ip 和 port，那么会造成很大浪费。可以采用 socket，减少层间传输的信息量。</p><p>socket：用代号（一个整数），表示通信的双方或单方。用一个整数表示两个应用实体之间的通信关系，代表自己和对方的 ip 和 port 的<strong>本地表示</strong>。可以使得穿过层间接口的信息量最小，且便于管理。</p><p>socket 是本地应用层和传输层的约定，只有本地操作系统知道，对方是不知道的。收发的时候<strong>查表</strong>就行，操作系统负责维护这张表</p><p>TCP 的 socket，代表的是<strong>会话关系</strong>，是<strong>四元组，源和目标的 ip+port</strong>。目标主机两个不同的端口，对应两个不同的 socket</p><p>UDP 的 socket，对应<strong>二元组，包含本地的 ip+port</strong>。通过层间接口时：需要传数据、传 UDP socket 和目标主机的 ip+port 才能发送出去。</p><p>** 应用进程使用传输层服务，如何实现报文交换？** 定义协议，编写程序，借助 OS 的接口</p></blockquote><p><strong>如何描述传输层的服务？应用层需要传输层提供什么样的服务？</strong></p><ul><li>数据丢失率</li><li>吞吐量</li><li>时间敏感性（延迟）</li><li>安全性（机密性、完整性、可认证性）</li></ul><p>TCP<strong> 实体</strong>：实现网络协议（TCP 协议）的软硬件模块</p><p><strong>传输层提供的服务</strong></p><ul><li>TCP 服务：可靠、流量控制、拥塞控制、面向连接。不保证时间、最小吞吐和安全性。</li><li>UDP 服务：不可靠，不控制流量、拥塞，没有时间、带宽的保证。不建立连接。</li></ul><p><strong>安全性</strong>：</p><ul><li>TCP/UDP 都没有加密，明文传输</li><li>SSL 是在 TCP 上实现的。提供加密的 TCP 连接（私密性、数据完整性、可以提供端到端鉴别）</li><li>SSL 在应用层，采用 SSL 库，SSL 库采用 TCP 通信</li><li>SSL socket API</li></ul><h1 id="web与http"><a class="anchor" href="#web与http">#</a> WEB 与 HTTP</h1><p><strong>web 页</strong>：由一些对象组成（可以使 HTML 文件，可以使 JPG 图片，Java 程序等）</p><p>web 页含有一个基本的 HTML 文件，这个文件里又包含对于若干个对象的引用。通过 url 对每个对象进行引用。</p><p>url 的格式为 <code>Prot://user:psw@www.someSchool.edu/someDept/pic.gif:port</code> （协议名、用户、口令、主机名、路径名、端口）</p><p><strong>HTTP</strong>：超文本（携带各种资源）传输协议，是 web 的应用层协议，采用<strong>客户（浏览器）/ 服务器</strong>模式。跑在 TCP 上。是无状态的。</p><p>服务器在 80 号端口打开一个 socket（守候 socket），然后当一个 web 浏览器与服务器建立连接时，新建另一个 socket（连接 socket）来标识这个连接。原来的守候 socket 仍然在 80 端口监听</p><ul><li>非持久 HTTP（HTTP 1.0）：TCP 连接建立（一趟往返），HTTP 传数据（一趟往返），TCP 连接拆除。</li><li>持久 HTTP（HTTP 1.1）：TCP 连接建立，HTTP 连接，TCP 连接不关，可以一直通过 HTTP 传数据。</li></ul><p>如果使用 HTTP 1.0，我们通过解析 base.html 文件，发现了（如 10 个）资源，然后要再次建立 TCP 连接，请求对象，然后拆除关闭连接。</p><p><strong>相应时间模型</strong></p><ul><li><strong>RTT(round-trip time)</strong> 往返时间</li><li>HTTP 1.0（非持久 HTTP）的响应时间是：2RTT + 传输时间</li><li>HTTP 1.1（持久 HTTP）<ul><li>流水线方式：请求直接 ” 流水 “ 发出</li><li>非流水线方式：一个一个请求。前一个对象回来，后一个请求发出</li></ul></li></ul><p><strong>HTTP 请求报文</strong>：</p><ul><li>采用 ASCII 码（人能阅读）</li><li>请求行包括 method（GET/POST/HEAD/PUT/DELETE），url 和 version 信息。<ul><li>put 和 delete 通常是维护使用。需要网络管理员使用一些工具进行请求。</li><li>head 命令通常只请求首部，用于搜索引擎建立索引或者网站维护。</li></ul></li><li>首部行（好多行，格式为首部名：首部值）</li><li>换行回车符，表示报文结束</li><li>如果有 body 那再传 body（有些命令如 post 包含 body，有些命令不包含 body）</li></ul><p>TCP 上运行的所有应用进程，都<strong>需要自己维护报文之间的界限</strong>。</p><p><strong>HTTP 响应</strong>：</p><p>状态码：200 OK，301 已被永久移除， 400 请求无法理解， 404 资源未找到， 505 版本号不支持。</p><p><strong>HTTP 协议是无状态的协议</strong>（服务器不维护客户端的状态）</p><p><strong>Cookie 机制维持客户状态</strong>：第一次发送请求，不带 cookie，服务器生成并发送 cookie，后续请求携带 cookie。可以做用户行为的分析，但是也涉及到隐私问题。</p><p><strong>web 缓存机制</strong>：用户通过代理服务器访问资源。代理服务器通常较多。代理服务器没有，则向 original server 请求，并缓存，然后返回给用户。（好处：用户体验快。服务器端的负载较轻。）</p><p>为什么要用 web 缓存？大家的访问具有趋同性。如果流量强度大，那么排队延时就会很大。使用缓存可以减少网络的载荷。</p><p>缓存：本地命中，直接返回，本地不命中，从外网服务器中取数据。如果 original server 的对象发生修改，检查 web 缓存，有需要则更新</p><h1 id="ftp协议"><a class="anchor" href="#ftp协议">#</a> FTP 协议</h1><p>现在用的已经不多。</p><p><strong>功能</strong>：可以上传下载（对于客户端而言）。</p><p><strong>工作原理</strong>：<strong>控制连接与数据连接分开</strong>。FTP 服务器守护在 21 端口。先建立 TCP 连接（控制连接），然后进行身份认证（用户名和口令），完成认证后，客户端可以通过某种指令，向服务器请求某个文件。服务器收到指令，会 ** 主动（有点违反常理）** 与客户端 20 号端口建立 TCP 数据连接。</p><blockquote><p>控制报文与数据报文分开传，就是<strong>带外的</strong>。合在一起就是<strong>带内的</strong>。</p></blockquote><p><strong>组成</strong>：FTP 客户端，FTP 服务器，用户接口，本地文件系统。</p><p>FTP 是有状态的。要维护客户端的状态。</p><p><strong>FTP 命令与响应</strong>：</p><ul><li><strong>命令</strong>在控制连接上以 ASCII 码文本的方式传送。如 USER username，PASS password，LIST，RETR filename，STOR filename 等</li><li><strong>返回码</strong>样例：状态码和状态码解释。</li></ul><h1 id="e-mail电子邮件"><a class="anchor" href="#e-mail电子邮件">#</a> E-Mail 电子邮件</h1><p><strong>组成部分</strong>：用户代理（客户端软件 outlook，foxmail 等），邮件服务器（就是服务器），发送协议：简单邮件传输协议 SMTP，拉取协议：POP 3，IMAP，HTTP 也可以。</p><blockquote><p>IMAP 协议不仅可以拉取，还可以远程管理目录，比如在收件箱中建文件夹，移动邮件到另一个文件夹中等。但 POP 3 协议不支持这个功能。</p></blockquote><p><strong>发信（SMTP 协议）</strong>：用户代理，配置好邮件服务器的 ip 地址端口号，通过邮件服务器发邮件。用户代理把邮件发给邮件服务器，暂存在队列中，邮件服务器从队列中挨个取邮件，然后向相应的目标邮件服务器发送。目标邮件服务器受到邮件后，放到每个用户的 mailbox 中。</p><p><strong>收信（三种协议都可）</strong>：用户通过用户代理，从邮件服务器中的邮箱里拉取收到的信件。</p><p>** 为什么放在队列中发？** 进来的速度和处理（发出）的速度有差别，要用队列平滑一下。发邮件不是来了就发，而是定期发，比如五分钟十分钟。不至于服务器那么劳累。有时候也没有这么多邮件发，所以是定期发。</p><p><strong>email 过程，简单 SMTP 发送</strong>：简单，采用 ascii 码。容易被篡改。安全性不高。可打印，所以是 readable。</p><blockquote><p>SMTP 和 HTTP 的比较。都采用 ASCII 码，都支持相应交互。</p><p>HTTP 是 pull 的，每个对象有单独的相应报文。</p><p>SMTP 是 push 的，多个对象整合在一个报文里（邮件可携带附件）。</p></blockquote><p><strong>SMTP 协议包含</strong>：首部行（包括 to，from，subject 还有抄送人 cc 等），空行以及 body</p><p><strong>但这里会产生一个问题，原式的 SMTP 只支持 ASCII，那么图片，汉子等都传不了了。所以有 MIME 多媒体邮件扩展。</strong></p><p>MIME 采用了 base64 的编码。base64 编码是通过 ASCII 码做的映射。相当于把若干个不在 ASCII 码范围内的字节，转化为在 ASCII 范围内的字节，然后进行传输。</p><p>因此原式的邮件协议经过扩展，可以传输中文和 exe 等文件。</p><p><strong>POP 3 协议</strong>：</p><p>可以跑在 tcp 上也可以跑在 ssl 上。</p><p>POP 3 可以采用下载并删除模式（一个端看了另一个端就看不到了）和下载并保留模式（每个端都可以看到）。</p><p>POP 3 是无状态的协议。</p><p><strong>IMAP 协议</strong>：有状态，因为可以维护远程目录</p><h1 id="dns-domain-name-system-域名解析系统"><a class="anchor" href="#dns-domain-name-system-域名解析系统">#</a> DNS (Domain Name System) 域名解析系统</h1><p>不是给人使用的。而是为其他应用所使用的。提供域名到 ip 地址的转换。是跑在应用层的基础设施。</p><p>web 系统以及 ftp 等系统都要使用 DNS 服务。</p><p><strong>DNS 系统的必要性</strong></p><p>网络层工作的主机，通过 ip 地址标识自己，也方便别人找到它（寻址）。但 ip 地址不好记。人们常常习惯于用有意义的字符串来标识 internet 上的设备。因此，就需要一个 DNS 系统，通过字符串找到 ip。</p><p>** 如何命名？** 分层的命名，方便增加。</p><p>** 对应关系如何解析？** 不能集中式维护。分布式的数据库，进行解析。</p><p><strong>运行在 UDP 的 53 号端口。</strong></p><p>DNS 是在主机系统的应用层实现的。是互联网的核心功能，但不在网络核心，而在边缘系统实现。<strong>互联网的复杂性体现在网络边缘。在边缘的传输层以上。</strong></p><p><strong>DNS 的主要目的</strong>：</p><p>提供域名到 ip 地址的转换，提供主机别名到规范名字的转换。还提供负载均衡的功能。</p><blockquote><p>一个域名通常对应一个服务器集群去支持它的访问。比如 github.com 这个域名，必定对应着许多服务器。github.com 这个域名是所有服务器的别名。每个服务器为了区分，有着不同的规范名字，如 server123.github.com 等。</p></blockquote><p>**DNS 采用层次树状结构的命名方法。** 树叶代表主机。</p><p>顶级域</p><blockquote><p>通用：.com .net .gov .edu .org 等</p><p>国家：.cn .us .nl .jp 等</p></blockquote><p>每个域（子域）下面可以更加分为不同的子域。在子域可以对每台主机进行命名。<strong>解决了重名问题</strong>：从本域往上，用点号分割。</p><p>域是逻辑的。与物理网络无关。</p><blockquote><p>一个域的主机，可以分属不同的网络；在同一个网络的主机，可能分属不同的域。</p></blockquote><p><strong>DNS 根名字服务器</strong></p><p>所有的域名归结到一个根上。但如果只有一个名字服务器的话，如果宕机就会有灾难性后果（可靠性问题），通信容量也不够大（可扩展性问题），维护非常麻烦（可维护性问题）。互联网的根名字服务器一共有 13 个。</p><p>查询域名的时候，要从 13 个根的任何一个往下去寻找。这样比较可靠一点。这 13 个根大部分在北美，欧洲和日本也有，中国大陆没有。</p><p>**DNS13 个根一个都不在中国，有安全风险？** 是又不是。</p><p>为了解决单个名字服务器的可靠性，可扩展性以及可维护性的问题，<strong>我们将域分成一个个区域</strong>，区域互不重叠。</p><p>每一个区域设置一个<strong>权威名字服务器</strong>。维护这个区域上的域名和 ip 地址。名字服务器可以设置在区域之外，以保障可靠性。</p><p><strong>TLD 服务器</strong>：顶级域服务器负责查询顶级域名和国家域名。</p><p><strong>区域名字服务器维护资源记录（数据库）</strong>：域名到 ip 地址的对应关系，子域等信息。字段包含域名、ttl 生存时间、class，value 和 type。</p><blockquote><p>ttl 生存时间是为了效率而存在的，ttl 到期则删除，保证一致性（如果是权威记录，那么 ttl 是无限大）</p><p>class 是代表网络类型。如 IN 代表 Internet 互联网。</p><p>type 表示不同的意思</p><ul><li>type 是 A 的话：name 字段代表主机，value 字段代表 IP 地址</li><li>type 是 CNAME 的话：name 字段为规范名字的别名，value 字段放规范名字</li><li>type 是 MX Mailbox 的话：name 字段是邮件服务器的别名，value 放的是邮件服务器别名所对应的规范名字</li><li>type 是 NS，那么 name 是域名，value 为该域名的权威服务器域名。</li></ul></blockquote><p><strong>DNS 大致工作流程</strong></p><ol><li><p>应用调用解析器 resolver</p></li><li><p>解析器作为客户，向 Name Server 发出查询报文（UDP）</p><blockquote><p>解析器怎么知道 local name server 的 ip 地址？是配置好的。或手工配，或者通过 DHCP 协议自动配。</p><p>一个机器上线之后，必须要知道这几个信息：ip 地址，子网掩码，local name server 是什么，default gateway 默认网关</p><p><strong>本地名字服务器</strong> LNS 并不严格属于层次结构，每个 ISP（居民区的 ISP，公司，大学）都有一个本地的 DNS 服务器。也称为默认名字服务器。当一个主机发起 DNS 查询时，这个查询就被发送到其本地 DNS 服务器上（起着代理的作用，将查询转发到层次结构中去）</p><p>如果 LNS 中有缓存，直接返回。</p><p>如果没有缓存</p><ul><li>采用递归查询方法，顺着树根查下来（往下找，一直找到权威的名字服务器，然后得到域名和 ip 的关系）但是这种递归查询很烦，因为都要问根服务器，所以就很忙。</li><li>还有迭代查询方法，“类似踢皮球”</li></ul></blockquote></li><li><p>Name Server 返回相应报文（name /ip）</p></li></ol><p><strong>DNS 协议、报文</strong></p><p>查询和相应的报文相同。</p><p>报文首部：标识符 (ID)，flags（包括：查询 / 应答，希望递归，递归可用，应答为权威等字段）</p><p><strong>提高性能</strong>：缓存</p><p>一旦名字服务器学到了一个映射，就将该映射缓存起来。</p><p>根服务器通常都在本地服务器中缓存着，使得根服务器不用经常被访问。</p><p>可能存在的问题：如果情况发生变化，缓存结果就会和权威记录不一致。所以设置 TTL（默认两天）</p><p><strong>维护问题：新增一个域</strong></p><p>上级域的名字服务器中增加两条记录，指向这个新增的子域的域名和域名服务器的地址。</p><p>在新增子域的名字服务器上运行名字服务器，负责本域的名字解析。名字 -&gt;IP 地址。</p><p><strong>攻击 DNS</strong>： 总的来说 DNS 比较健壮。</p><p><strong>DDOS 攻击</strong></p><ul><li><p>对服务器进行流量轰炸攻击：发送大量 ping 命令。</p><blockquote><p>没有成功，原因是：根目录服务器配置了流量过滤器，防火墙。local DNS 服务器缓存了 TLD 服务器的 IP 地址，因此无需查询根服务器。</p></blockquote></li><li><p>向 TLD 服务器进行流量轰炸攻击：发送大量查询</p><blockquote><p>可能更危险，但是效果一般。因为大部分 DNS 缓存了 TLD。</p></blockquote></li></ul><p><strong>重定向攻击</strong></p><ul><li><p>中间人攻击</p><blockquote><p>截获查询，伪造回答，从而攻击某个（DNS 回答指定的 IP）结点</p></blockquote></li><li><p>DNS 中毒</p><blockquote><p>发送伪造的应答给 DNS 服务器，希望它能够缓存这个虚假的结果。</p></blockquote></li><li><p>技术上较困难</p></li></ul><p><strong>利用 DNS 基础设施进行 DDOS 攻击</strong></p><ul><li>伪造某个 IP 进行查询，攻击这个目标 IP。</li><li>查询放大，相应报文比查询报文大</li><li>效果有限</li></ul><p><strong>因为基本上所有 DNS 服务器都缓存了顶级域名的对应关系，所以即便中国没有 13 根，也没有那么大的安全隐患。</strong></p><h1 id="p2p应用"><a class="anchor" href="#p2p应用">#</a> P2P 应用</h1><p><strong>纯 P2P 应用</strong>：没有（或极少）一直在运行的服务器。任意端系统都可以直接通信。P2P 系统既是客户端，又是服务器。peer 结点间歇性上网，每次 IP 地址都有可能变化。</p><p>可靠性高。流量是分布式的。是由成千上万个 peer 结点提供的。</p><p><strong>例子</strong>：文件分发（BitTorrent），流媒体（KanKan），VoIP（Skype 互联网电话）等</p><p><strong>传统的 CS 架构分发文件</strong>：从服务器向 N 台不同的主机，分发统一文件 F。时间下限为：$$\max {\frac {F}{D_{min}},\frac {NF}{U_s}}$$（$$D_i$$ 代表客户端下载带宽，$$U_s$$ 是服务器的上传带宽）<strong>随着客户端数 N 越来越大，服务器的上载带宽成为瓶颈，下载时间随着用户增加线性增加。</strong></p><ul><li>当客户端少时，瓶颈是客户端的下载带宽。</li><li>当客户端多时，瓶颈是服务端的上载带宽。</li></ul><p><strong>P2P 分发文件</strong>：为了解决 CS 模式可扩展性问题。分发文件 F 的时间下限为 $$\max {\frac<ruby>F}{D_{min}},\frac{NF}{U_s},\frac{NF}{U_s+\sum_{i=1}<rp>(</rp><rt>N U_i</rt><rp>)</rp></ruby>}$$（假设服务器有一个文件的拷贝，每一个客户端都有一份文件，每一个节点都可以上载。）但是由于 P2P 网络具有动态性，因此不易管理。</p><p><strong>P2P 的类型</strong></p><ul><li>非结构化 P2P</li><li>DHT（结构化）P2P 【基于分布式散列表】（暂不学</li></ul><p>**P2P 应用通过会话间的合作关系，相互协作，形成了一个覆盖网 overlay（是一种应用层上的逻辑网络）** 如果 overlay 是任意的、随机的，就是非结构化的 P2P；如果 overlay 是有序的，构成环或者树，那就是 DHT 结构化的。</p><p><strong>非结构化 P2P</strong></p><ul><li><p>有集中化目录的文件分发系统（如 Napster）</p><ul><li>每个结点上线时都要向目录服务器注册（我是哪台主机，我有哪些资源）</li><li>结点请求资源时，要从目录服务器获得资源结点 list（哪些结点有这个资源）然后向这些结点请求资源。</li><li>目录服务器存在单点故障、性能瓶颈的问题。也可能存在侵权问题。</li></ul></li><li><p>完全分布式的文件分发系统（如 Gnutella）</p><ul><li><p>没有中心服务器。所有结点构建成一个 Overlay。</p><blockquote><p>如何建立 Overlay？下载 Gnutella 客户端时，有一个配置文件。其中有若干个 Gnutella 网络经常在线的结点的 IP。</p><p>只要同其中一个建立联系，那么就可以通过其中转，随机与一些结点连接，接入 Gnutella 网络。</p><p>如果要下线，那么要一个个与邻居切断联系。此时邻居需要随机找另一个主机连接，以维持连接强度。</p></blockquote></li><li><p>结点通过泛洪的方式进行资源查询。通过 Overlay，先找邻居，然后再找邻居的邻居，以 “发洪水” 的方式查询全网。拥有资源的服务器给出应答。以此构建资源目录。</p><blockquote><p>泛洪查询方法存在问题。查询可能会陷入循环，还可能被放大。这样不行</p><p>解决方法：1. 设置 TTL，比如说五跳查询失效；2. 添加一个结点访问状态。被访问的结点不在泛洪。</p></blockquote></li><li><p>根据资源目录，向拥有资源的服务器发起查询</p></li></ul><blockquote><p>Gnutella 的运行非常不成功。有人说在 Gnutella 网络上什么也找不到。后来才被迫开源，但也没有扩充太多用户群。</p></blockquote></li><li><p>混合体，利用不对称性（例如 KaZaA）</p><ul><li>每个结点都属于一个组。要么是组长，要么是组员。</li><li>组长和组长的关系是 Gnutella 关系。组长和组员的关系是 Napster 关系。<strong>组内集中式，组间分布式</strong></li><li>将文件对应的哈希值，作为唯一 ID，标识文件。</li></ul></li></ul><p><strong>BitTorrent（也属于非结构化）</strong></p><p><strong>工作原理</strong>：peer 要加入一个 Torrent 中（Torrent：结点的组，之间互相交换文件，互通有无）</p><p>每个结点都拥有文件的一部分块。根据拥有块的多少，有一个对应的 bitmap。每隔一段时间，torrent 中的所有结点会通过泛洪的方式，交换 bitmap。</p><p>一个新结点加入时，bitmap 全 0，随机请求 4 块。然后根据稀缺优先原则，请求剩下的块。同时，按照 **tit-for-tat（针锋相对）** 的策略为其他结点提供服务。（对我好的节点，我也对他好）</p><blockquote><p>由于稀缺优先的策略，所以自己被别人请求的概率就会变大，所以别人就会给自己提供更好的服务。所以，根据针锋相对的规则，自己的下载速度就会更快。性能就会更高</p><p>如果一个结点拥有这个文件的全部，就是<strong>种子</strong>。否则就是<strong>吸血鬼</strong>。种子可以选择离开。</p></blockquote><p>是不是所有结点来了都要提供服务呢？采取<strong>有限疏通</strong>的方式。每三个周期中，前两个周期，排队优先级根据对方提供的带宽大小确定。第三个周期，采用随机的方法优化疏通。</p><p><strong>如何加入 torrent：</strong></p><ul><li>采用带外方式。在文件分发的网站，根据描述进行匹配，找到对应的 hash 值，然后下载对应的 torrent 文件。</li><li>torrent 文件是描述信息，携带了维护这个文件的 tracking server（跟踪服务器）信息</li><li>检索的这个结点，就要向 tracking server 发送加入洪流的请求。通过 tracking server 找到 peer 结点，构成洪流，互通有无</li></ul><p><strong>结构化 DHT P2P</strong>：维护的是一种树状、环状的有序拓扑。不是用 IP 地址，而是用 IP 地址的 hash 值作为唯一标识。</p><p>以环状拓扑为例，结点按照 hash 值大小首尾相连构成环。然后对文件也作哈希。</p><p>比如说一个 DHT P2P 中有【5】和【88】等结点，那么文件哈希值为 6-88 的，那么这些文件的目录，都维护在 88 这个结点处。</p><h1 id="视频优化服务和cdn上下文"><a class="anchor" href="#视频优化服务和cdn上下文">#</a> 视频优化服务和 CDN：上下文</h1><p>互联网中，杀手级应用有很多种，其中视频业务是其中一种。<strong>据统计，互联网中七八成的流量都被视频流量占据。</strong></p><p><strong>杀手级应用</strong>：网络流量占的比较多，而且可以吸引用户。</p><p>** 如何向成千上万的人提供并行的播放业务？** 挑战：规模性问题，以及每个结点的网络带宽制约，需求不同。由于客户端异构，需要的视频质量也不尽相同</p><p><strong>采用分布式的应用层面的基础设施 CDN 来解决</strong>。</p><p><strong>视频是什么</strong>？图像序列。利用了视觉的滞留效应。有一个帧率。</p><p><strong>视频压缩</strong>：视频如果不压缩，直接传输，通常占用带宽很大。一般都<strong>以小码率传输</strong>。对时间冗余和空间冗余进行压缩。</p><p>有 CBR 和 VBR 两种编码策略。</p><p><strong>存储视频的流化服务</strong>一边下一遍播放。</p><p><strong>多媒体流化服务器 DASH</strong></p><ul><li>服务器将文件分成多个块，以不同码率编码、存储。</li><li>生成告示文件 manifest，提供不同块的 URL。</li><li>边看便请求，自动决定要向哪些服务器请求后续块。</li></ul><p><strong>Content Distribution Network (CDN) 内容分化网络</strong>：服务器如何通过网路向上百万用户同时提供流化视频服务？</p><p><strong>存在的问题</strong>：1. 跳数比较多 2. 网上的重复流量比较多（浪费）3. 单点故障 4. 服务器瓶颈 5. 网络拥塞</p><p><strong>CDN 服务商在全球部署 CDN 缓存结点</strong>。用户可以通过域名解析重定向的技术，定位到（离他最近的，服务最好的）CDN 服务器。</p><p>视频流媒体提供者，购买 CDN 运营商的服务。ISP 购买 CDN 运营商的服务，提升 ISP 运营商服务用户的能力。</p><p><strong>CDN 运营商的部署策略</strong>：</p><ul><li><strong>enter deep 策略</strong>：部署在 local ISP，深入接入网，离用户进，数量多，质量好，但难以管理。</li><li><strong>bring home 策略</strong>：部署在少数关键结点。而是部署到上层的 ISP 的附近，如在某些数据中心机房附近。</li></ul><p><strong>用户怎么知道从哪个 CDN 访问资源呢</strong>：1. manifest 文件 2. 域名解析重定向 3. 如果网络路径堵塞，可以选择不同的拷贝</p><p><strong>CDN 结点运行在应用层，运行在网络的边缘，呈现 OVER-THE-TOP 的特点。挑战主要在</strong>：</p><ul><li>那么多节点有，我从哪个缓存节点获取？</li><li>如果结点堵塞，我怎么换另一个结点？</li><li>我应该在那些结点部署拷贝？</li></ul><p><strong>CDN 使用的简单场景</strong>：</p><ol><li>用户通过视频链接，访问并解析。</li><li>然后根据 DNS 解析，问 LocalNameServer。</li><li>从 LNS 的权威名字服务器中，查到的不是一个 ip，而是重定向（返回了另一个域名）</li><li>再去解析返回的命名，就会解析到 CDN 的权威名字服务器。</li><li>然后 CDN 的权威名字服务器，给到一个 ip 地址，这个 IP 地址是离用户最近的。</li><li>由这个 IP 地址向用户提供流化服务。</li></ol><p>CDN 的重定向对用户是透明的，根本感受不到是原始服务器还是 CDN 服务器提供服务。</p><h1 id="tcp-socket编程"><a class="anchor" href="#tcp-socket编程">#</a> TCP Socket 编程</h1><p>应用进程使用传输层提供的服务，才能互相通信。传输层提供 Socket API</p><ul><li>TCP 可靠的，字节流的服务，无连接。<strong>保证按照流是对的，但是不保证界限。报文需要应用自己维护</strong></li><li>UDP 不可靠的（数据 UDP 数据报）数据报，有连接。</li></ul><p><strong>前面学过，Socket 就是一个整数</strong>。就像文件句柄一样。对 Socket 操作，就是对会话上两个应用进程之间的操作。TCP Socket 的整数代表了自己的 ip+port 和对方的 ip+port，代表两个进程间的会话关系。</p><p><strong>TCP Socket 编程场景</strong>：<strong>通过 socket 的方式，将小写字母变成大写</strong>。</p><ol><li>前提：服务器要先运行（C/S 模式）等待连接</li><li>服务器创建 welcome Socket，返回一个整数，然后这个 socket 会与服务器本地的 ip/port 相捆绑。</li><li>服务器调用 socket api 中的 accept 函数。阻塞式等待远程客户端的 socket 连接建立请求。</li><li>之后，客户端也要创建 socket，然后返回整数，与客户端本地的 ip/port 进行隐式（如果你不指定，就默认和当前一个没有用的端口）的捆绑。</li><li>客户端调用 calnet 函数，指定服务器的 ip/port，与服务器进行阻塞式连接。</li><li>如果客户端收到了服务器的确认，那么连接建立。此时客户端 calnet 就会解除阻塞，向客户端返回一个有效值。</li><li>服务端的 welcome socket 在 accept 客户端的请求后，会返回一个新的 socket（connection socket）包含了服务器 ip/port（没变），还包含了客户端的 ip/port。</li><li>连接建立，然后可以开始收发。收发完成后，解除 connection socket，但 welcome socket 仍然在守候。</li></ol><p><img data-src="image-20220307104911476.png" alt="image-20220307104911476"></p><p><strong>两个重要的结构体</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">short</span> sin_family<span class="token punctuation">;</span> <span class="token comment">//AF_INET 协议族</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	u_short sin_port<span class="token punctuation">;</span> <span class="token comment">//port</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">in_addr</span> sin_addr<span class="token punctuation">;</span> <span class="token comment">// ip address, unsigned long</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">char</span> sin_zero<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//align</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>不仅可以用于 IP 通信，也可以用 IPX 的通信。</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span>h_name<span class="token punctuation">;</span> <span class="token comment">// 主机域名</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>h_aliases<span class="token punctuation">;</span> <span class="token comment">// 主机别名</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">int</span> h_addrtype<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">int</span> h_length<span class="token punctuation">;</span> <span class="token comment">// 地址长度</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>h_addr_list<span class="token punctuation">;</span> <span class="token comment">// 给出 ip 地址列表</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">h_addr</span> <span class="token expression">h_addr_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token comment">// 主要作域名解析的函数调用</span></pre></td></tr></table></figure><p><strong>客户端 TCP socket 代码</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* client.c */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sad<span class="token punctuation">;</span> <span class="token comment">/* structure to hold an lP address of server */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">int</span> clientSocket<span class="token punctuation">;</span> <span class="token comment">/* socket descriptor */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span>ptrh<span class="token punctuation">;</span> <span class="token comment">/* pointer to a host table entry */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">char</span> Sentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> modifiedSentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    host <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> port <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    </pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">/* Create client socket, connect to server: */</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sad<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>sad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* clear sockaddr structure */</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    sad<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span> <span class="token comment">/* set family to Internet */</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    sad<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_short<span class="token punctuation">)</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    ptrh <span class="token operator">=</span> <span class="token function">gethostbyname</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*Convert host name to lPaddress */</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sad<span class="token punctuation">.</span>sin_addr<span class="token punctuation">,</span> ptrh<span class="token operator">-></span>h_addr， ptrh<span class="token operator">-></span>h_length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 lP 地址拷贝到 sad.sin__addr</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">connect</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sad<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">/* get input stream from user*/</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">gets</span><span class="token punctuation">(</span>Sentence<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    </pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">/*send line to server*/</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    n <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">,</span> Sentence<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>Sentence<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    </pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">/* Read line from server */</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">,</span> modifiedSentence<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>modifiedSentence<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    </pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"FROM SERVER: %sln"</span><span class="token punctuation">,</span>modifiedSentence<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    </pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">/*Close connection*/</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>服务端 TCP socket 代码</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*server.c */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sad<span class="token punctuation">;</span> <span class="token comment">/* structure to hold an lP address of server*/</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> cad<span class="token punctuation">;</span> <span class="token comment">/*client */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> welcomeSocket<span class="token punctuation">,</span>connectionSocket<span class="token punctuation">;</span> <span class="token comment">/* socket descriptor *lstruct hostent *ptrh; l* pointer to a host table entry */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">char</span> clientSentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> capitalizdSentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    port <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    </pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">/* create welcoming socket at port &amp; bind a local address*/</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    welcomeSocket <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span>SOCK_STREAM，O<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sad<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>sad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* clear sockaddr structure *lsad.sin_family = AF_INET; /* set family to lnternet */</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    sad<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span> <span class="token comment">/*set the local lP address */</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    sad<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_short<span class="token punctuation">)</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*set the port number */</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">bind</span><span class="token punctuation">(</span>welcomeSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sad<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    </pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">/* Specify the maximum number of clients that can be queued */</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token function">listen</span><span class="token punctuation">(</span>welcomesocket，<span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">/*wait on welcoming socket for contact by a client*/</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    	connectionSocket<span class="token operator">=</span><span class="token function">accept</span><span class="token punctuation">(</span>welcomeSocket<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>cad<span class="token punctuation">,</span><span class="token operator">&amp;</span>alen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>connectionSocket<span class="token punctuation">,</span> clientSentence<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>clientSentence<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment">/*capitalize Sentence and store the result in capitalizedSentence*/</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token comment">/*write out the result to socket*/</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        n<span class="token operator">=</span><span class="token function">write</span><span class="token punctuation">(</span>connectionSocket<span class="token punctuation">,</span> capitalizedSentence<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>capitalizedSentence<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token function">close</span><span class="token punctuation">(</span>connectionSocket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token comment">// end of while loop, loop back and wait for another client connection.</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="udp-socket编程"><a class="anchor" href="#udp-socket编程">#</a> UDP Socket 编程</h1><p><strong>没有握手</strong>。socket 只和本地 ip/port 捆绑，作为本地 ip/port 的代表。</p><p>所以<strong>发送报文时</strong>以 socket 作为参数，必须明确指明对方的 ip/port</p><p>进程<strong>接收报文时</strong>，必须从报文中提取出发送者的 ip/port 这样才能发回去。</p><p>可能乱序，可能丢失。因为无连接，所以可以叫做数据报。</p><p><img data-src="image-20220308000145832.png" alt="image-20220308000145832"></p><p><strong>UDP 客户端代码</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* client.c */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc，<span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sad<span class="token punctuation">;</span> <span class="token comment">/* structure to hold an lP address */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">int</span> clientSocket<span class="token punctuation">;</span> <span class="token comment">/* socket descriptor */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span>ptrh<span class="token punctuation">;</span> <span class="token comment">/* pointer to a host table entry */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">char</span> Sentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> modifiedSentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    host <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> port <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    clientSocket <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span>SOCK_DGRAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* determine the server's address */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sad<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>sad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* clear sockaddr structure */</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    sad<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span><span class="token comment">/* set family to Internet */</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    sad<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_short<span class="token punctuation">)</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    ptrh <span class="token operator">=</span> <span class="token function">gethostbyname</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">/* Convert host name to lPaddress */</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sad<span class="token punctuation">.</span>sin_addr<span class="token punctuation">,</span>ptrh<span class="token operator">-></span>h_addr， ptrh<span class="token operator">-></span>h_length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">gets</span><span class="token punctuation">(</span>Sentence<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*Get input stream from user*/</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">/* send line to server */</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    addr_len <span class="token operator">=</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    n<span class="token operator">=</span><span class="token function">sendto</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">,</span> Sentence<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>Sentence<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>sad， addr len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">/*read line from server*/</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    n<span class="token operator">=</span><span class="token function">recvfrom</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">,</span> modifiedSentence<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>modifiedSentence<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>sad，<span class="token operator">&amp;</span>addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"FROM SERVER: %sln"</span><span class="token punctuation">,</span>modifiedSentence<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>clientSocket<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*close connection*/</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>UDP 服务端代码</strong></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*server.c */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc， <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sad<span class="token punctuation">;</span> <span class="token comment">/* structure to hold an lP address */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> cad<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> serverSocket<span class="token punctuation">;</span> <span class="token comment">/* socket descriptor */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span>ptrh<span class="token punctuation">;</span> <span class="token comment">/* pointer to a host table entry */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> clientSentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">char</span> capitalizedSentence<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    port <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">/* create welcoming socket at port &amp; bind a local address*/</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    serverSocket <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span>sOCK_DGRAM，O<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sad<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>sad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* clear sockaddr structure */</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    sad<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF__INET<span class="token punctuation">;</span><span class="token comment">/* set family to Internet */</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    sad<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span> <span class="token comment">/* set the local lP address */</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    sad<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_short<span class="token punctuation">)</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* set the port number */</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">bind</span><span class="token punctuation">(</span>serverSocket<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sad<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>sad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    </pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        n<span class="token operator">=</span><span class="token function">recvfrom</span><span class="token punctuation">(</span>serverSocket<span class="token punctuation">,</span> clientSentence<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>clientSentence<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>cad，<span class="token operator">&amp;</span>addr_len <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*receiving messages from clients*/</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token comment">/* capitalize Sentence and store the result in capitalizedSentence*/</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        n<span class="token operator">=</span><span class="token function">sendto</span><span class="token punctuation">(</span>serverSocket <span class="token punctuation">,</span> capitalizedSentence<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>capitalizedSentence<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>，<span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>cad， <span class="token operator">&amp;</span>addr len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*write out the result to socket*/</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token comment">// end of the loop, loop back and wait for another client connection.</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> 笔记</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-18 20:44:06" itemprop="dateModified" datetime="2022-10-18T20:44:06+08:00">2022-10-18</time> </span><span id="computer-science/computer-networks/Chapter-2-Application-Layer/" class="item leancloud_visitors" data-flag-title="Chapter 2 Application Layer" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Sunforge 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Sunforge 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Sunforge 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Sunforge <i class="ic i-at"><em>@</em></i>鑄日</li><li class="link"><strong>本文链接：</strong> <a href="http://blog.sunforge.cn/computer-science/computer-networks/Chapter-2-Application-Layer/" title="Chapter 2 Application Layer">http://blog.sunforge.cn/computer-science/computer-networks/Chapter-2-Application-Layer/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/computer-science/computer-networks/Chapter-1-Computer-Networks-and-the-Internet/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipex2cdtbj20zk0m8x6p.jpg" title="Chapter 1 Computer Networks and the Internet"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机网络</span><h3>Chapter 1 Computer Networks and the Internet</h3></a></div><div class="item right"><a href="/computer-science/computer-networks/Chapter-3-Transport-Layer/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclil3m4ej20zk0m8tn8.jpg" title="Chapter 3 Transport Layer"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机网络</span><h3>Chapter 3 Transport Layer</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">应用层原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web%E4%B8%8Ehttp"><span class="toc-number">2.</span> <span class="toc-text">WEB 与 HTTP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ftp%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.</span> <span class="toc-text">FTP 协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#e-mail%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6"><span class="toc-number">4.</span> <span class="toc-text">E-Mail 电子邮件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dns-domain-name-system-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.</span> <span class="toc-text">DNS (Domain Name System) 域名解析系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#p2p%E5%BA%94%E7%94%A8"><span class="toc-number">6.</span> <span class="toc-text">P2P 应用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E4%BC%98%E5%8C%96%E6%9C%8D%E5%8A%A1%E5%92%8Ccdn%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">7.</span> <span class="toc-text">视频优化服务和 CDN：上下文</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tcp-socket%E7%BC%96%E7%A8%8B"><span class="toc-number">8.</span> <span class="toc-text">TCP Socket 编程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#udp-socket%E7%BC%96%E7%A8%8B"><span class="toc-number">9.</span> <span class="toc-text">UDP Socket 编程</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/computer-science/computer-networks/Chapter-1-Computer-Networks-and-the-Internet/" rel="bookmark" title="Chapter 1 Computer Networks and the Internet">Chapter 1 Computer Networks and the Internet</a></li><li class="active"><a href="/computer-science/computer-networks/Chapter-2-Application-Layer/" rel="bookmark" title="Chapter 2 Application Layer">Chapter 2 Application Layer</a></li><li><a href="/computer-science/computer-networks/Chapter-3-Transport-Layer/" rel="bookmark" title="Chapter 3 Transport Layer">Chapter 3 Transport Layer</a></li><li><a href="/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/" rel="bookmark" title="Chapter 4 The Network Layer: Data Plane">Chapter 4 The Network Layer: Data Plane</a></li><li><a href="/computer-science/computer-networks/Chapter-5-The-Network-Layer-Control-Plane/" rel="bookmark" title="Chapter 5 The Network Layer: Control Plane">Chapter 5 The Network Layer: Control Plane</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Sunforge" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Sunforge</p><div class="description" itemprop="description">计科人笔记</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">18</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">5</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0JFQVRJTkctSEVBUlQ=" title="https:&#x2F;&#x2F;github.com&#x2F;BEATING-HEART"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmJlYXRpbmdfaGVhcnRAeWVhaC5uZXQ=" title="mailto:beating_heart@yeah.net"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-person"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-magic"></i>魔盒</a><ul class="submenu"><li class="item"><a href="/webstack/" rel="section"><i class="ic i-star"></i>网址</a></li><li class="item"><a href="/books/" rel="section"><i class="ic i-clipboard"></i>书架</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/computer-science/computer-networks/Chapter-1-Computer-Networks-and-the-Internet/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/computer-science/computer-networks/Chapter-3-Transport-Layer/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" title="分类于 数据结构与算法">数据结构与算法</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%9B%BE%E8%AE%BA/" title="分类于 图论">图论</a></div><span><a href="/computer-science/data-structures-and-algorithms/bipartite-graph/" title="二分图">二分图</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-networks/Chapter-1-Computer-Networks-and-the-Internet/" title="Chapter 1 Computer Networks and the Internet">Chapter 1 Computer Networks and the Internet</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/hexo/" title="分类于 Hexo 博客">Hexo 博客</a></div><span><a href="/computer-science/hexo/%E4%BD%BF%E7%94%A8vercel%E6%89%98%E7%AE%A1Hexo%E5%8D%9A%E5%AE%A2%EF%BC%8C%E8%A7%A3%E5%86%B3github-io%E6%97%A0%E6%B3%95%E8%A2%ABbaidu%E6%94%B6%E5%BD%95%E7%9A%84%E9%97%AE%E9%A2%98/" title="使用vercel托管Hexo博客，解决github.io无法被baidu收录的问题">使用vercel托管Hexo博客，解决github.io无法被baidu收录的问题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-networks/Chapter-4-The-Network-Layer-Data-Plane/" title="Chapter 4 The Network Layer: Data Plane">Chapter 4 The Network Layer: Data Plane</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/computer-science/data-structures-and-algorithms/index/" title="数据结构与算法：索引">数据结构与算法：索引</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/" title="分类于 基本法则">基本法则</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/" title="分类于 数学">数学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/%E5%87%B8%E4%BC%98%E5%8C%96/" title="分类于 凸优化">凸优化</a></div><span><a href="/fundamental/math/convex-optimization/Chapter-2-Convex-sets/" title="凸优化第二章：凸集">凸优化第二章：凸集</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-networks/Chapter-5-The-Network-Layer-Control-Plane/" title="Chapter 5 The Network Layer: Control Plane">Chapter 5 The Network Layer: Control Plane</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" title="分类于 机器学习">机器学习</a></div><span><a href="/computer-science/machine-learning/index/" title="机器学习：索引">机器学习：索引</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" title="分类于 机器学习">机器学习</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/" title="分类于 回归模型">回归模型</a></div><span><a href="/computer-science/machine-learning/linear-regression/" title="机器学习：线性回归">机器学习：线性回归</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/" title="分类于 基本法则">基本法则</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/" title="分类于 数学">数学</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%9F%BA%E6%9C%AC%E6%B3%95%E5%88%99/%E6%95%B0%E5%AD%A6/%E5%87%B8%E4%BC%98%E5%8C%96/" title="分类于 凸优化">凸优化</a></div><span><a href="/fundamental/math/convex-optimization/Chapter-1-introduction/" title="凸优化第一章：导论">凸优化第一章：导论</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Sunforge @ Sunforge</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">124k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:53</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/computer-networks/Chapter-2-Application-Layer/",favicon:{show:"但你不会停止思考，对吗？",hide:"这个世界真复杂啊 | Sunforge"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>